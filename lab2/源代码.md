# VGA操作
AF12：下一条指令







```verilog
// 原教师版顶层文件
module CSSTE(
    input         clk_100mhz,
    input         RSTN,
    input  [3:0]  BTN_y,
    input  [15:0] SW,
    output [3:0]  Blue,
    output [3:0]  Green,
    output [3:0]  Red,
    output        HSYNC,
    output        VSYNC,
    output        LED_PEN,
    output        SEG_PEN,
    output        led_clk,
    output        led_clrn,
    output        led_sout,
    output        seg_clk,
    output        seg_clrn,
    output        seg_sout
    );
    wire [3:0] BTN_OK;
    wire [15:0] SW_OK;
    wire        rst;
    wire        Clk_CPU;
    wire [31:0] clkdiv;
    wire [31:0] Addr_out;
    wire [31:0] Data_out;
    wire [31:0] PC_out;
    wire        MemRW;
    wire [31:0] Inst_in;
    wire [31:0] Data_in;
    wire [9:0]  ram_addr;
    wire [31:0] ram_data_in;
    wire [31:0] RAM_B_0_douta;
    wire [31:0] U4_data_ram_we;
    wire        U4_GPIOe0000000_we;
    wire        U4_GPIOf0000000_we;
    wire [31:0] U4_Peripheral_in;
    wire        U10_counter0_OUT;
    wire        U10_counter1_OUT;
    wire        U10_counter2_OUT;
    wire [31:0] U10_counter_out;
    wire        U4_counter_we;
    wire [15:0] U7_LED_out;
    SCPU U1(.Addr_out(Addr_out),
        .Data_in(Data_in),
        .Data_out(Data_out),
        .MIO_ready(1'b0),
        .MemRW(MemRW),
        .PC_out(PC_out),
        .clk(Clk_CPU),
        .inst_in(Inst_in),
        .rst(rst));
    ROM_D_0 U2(.a(PC_out[11:2]),
        .spo(Inst_in));
    RAM_B U3(.addra(ram_addr),
        .clka(~clk_100mhz),
        .dina(ram_data_in),
        .douta(RAM_B_0_douta),
        .wea(U4_data_ram_we));
    MIO_BUS U4(.BTN(BTN_OK),
        .Cpu_data2bus(Data_out),
        .Cpu_data4bus(Data_in),
        .GPIOe0000000_we(U4_GPIOe0000000_we),
        .GPIOf0000000_we(U4_GPIOf0000000_we),
        .Peripheral_in(U4_Peripheral_in),
        .SW(SW_OK),
        .addr_bus(Addr_out),
        .clk(clk_100mhz),
        .counter0_out(U10_counter0_OUT),
        .counter1_out(U10_counter1_OUT),
        .counter2_out(U10_counter2_OUT),
        .counter_out(U10_counter_out),
        .counter_we(U4_counter_we),
        .data_ram_we(U4_data_ram_we),
        .led_out(U7_LED_out),
        .mem_w(MemRW),
        .ram_addr(ram_addr),
        .ram_data_in(ram_data_in),
        .ram_data_out(RAM_B_0_douta),
        .rst(rst));
    wire [31:0] Multi_8CH32_0_Disp_num;
    wire [7:0]  Multi_8CH32_0_LE_out;
    wire [7:0]  Multi_8CH32_0_point_out;
    Multi_8CH32 U5(.Data0(U4_Peripheral_in),
        .Disp_num(Multi_8CH32_0_Disp_num),
        .EN(U4_GPIOe0000000_we),
        .LES(64'b0),
        .LE_out(Multi_8CH32_0_LE_out),
        .Test(SW_OK[7:5]),
        .clk(~Clk_CPU),
        .data1({2'b0,PC_out[31:2]}),
        .data2(Inst_in),
        .data3(U10_counter_out),
        .data4(Addr_out),
        .data5(Data_out),
        .data6(Data_in),
        .data7(PC_out),
        .point_in({clkdiv[31:0],clkdiv[31:0]}),
        .point_out(Multi_8CH32_0_point_out),
        .rst(rst));
    SSeg7_Dev_0 U6(.Hexs(Multi_8CH32_0_Disp_num),
        .LES(Multi_8CH32_0_LE_out),
        .SEG_PEN(SEG_PEN),
        .SW0(SW_OK[0]),
        .Start(clkdiv[20]),
        .clk(clk_100mhz),
        .flash(clkdiv[25]),
        .point(Multi_8CH32_0_point_out),
        .rst(rst),
        .seg_clk(seg_clk),
        .seg_clrn(seg_clrn),
        .seg_sout(seg_sout));
    wire [1:0] U7_counter_set;
    SPIO U7(.EN(U4_GPIOf0000000_we),
        .LED_PEN(LED_PEN),
        .LED_out(U7_LED_out),
        .P_Data(U4_Peripheral_in),
        .Start(clkdiv[20]),
        .clk(~Clk_CPU),
        .counter_set(U7_counter_set),
        .led_clk(led_clk),
        .led_clrn(led_clrn),
        .led_sout(led_sout),
        .rst(rst));
    clk_div U8(.Clk_CPU(Clk_CPU),
        .STEP(BTN_OK[0]|SW_OK[10]),
        .SW2(SW_OK[2]),
        .SW8(SW_OK[8]),
        .clk(clk_100mhz),
        .clkdiv(clkdiv),
        .rst(rst));
    SAnti_jitter U9(.BTN_OK(BTN_OK),
        .Key_y(BTN_y),
        .RSTN(RSTN),
        .SW(SW),
        .SW_OK(SW_OK),
        .clk(clk_100mhz),
        .readn(1'b0),
        .rst(rst));
    Counter_x U10(.clk(~Clk_CPU),
                .clk0(clkdiv[6]),
                .clk1(clkdiv[9]),
                .clk2(clkdiv[11]),
                .counter0_OUT(U10_counter0_OUT),
                .counter1_OUT(U10_counter1_OUT),
                .counter2_OUT(U10_counter2_OUT),
                .counter_ch(U7_counter_set),
                .counter_out(U10_counter_out),
                .counter_val(U4_Peripheral_in),
                .counter_we(U4_counter_we),
                .rst(rst));
    VGA U11(.alu_res(Addr_out),
        .clk_100m(clk_100mhz),
        .clk_25m(clkdiv[1]),
        .dmem_addr(Addr_out),
        .dmem_i_data(ram_data_in),
        .dmem_o_data(RAM_B_0_douta),
        .hs(HSYNC),
        .inst(Inst_in),
        .mem_wen(MemRW),
        .pc(PC_out),
        .rst(rst),
        .vga_b(Blue),
        .vga_g(Green),
        .vga_r(Red),
        .vs(VSYNC));
endmodule
```







```verilog
//原zky verilog
module CSSTE(
    input clk_100mhz,
    input RSTN,
    input [3:0] BTN_y,
    input [15:0] SW,
    output led_clk,
    output led_clrn,
    output led_sout,
    output [3:0] Blue,
    output [3:0] Green,
    output [3:0] Red,
    output LED_PEN,
    output SEG_PEN,
    output HSYNC,
    output VSYNC,   
    output seg_clk,
    output seg_clrn,
    output seg_sout
);
    wire [31:0] Addr_out;
    wire [31:0] Data_in;
    wire [31:0] Data_out;
    wire [7:0] point_out;
    wire MemRW;
    wire [31:0] PC;
    wire Clk_CPU;
    wire [31:0] inst_in;
    wire rst;
    wire data_ram_we;
    wire counter2_out;
    wire GPIOe0000000_we;
    wire GPIOf0000000_we;
    wire [31:0] Peripheral_in;
    wire [15:0] SW_OK;
    wire [15:0] led_out;
    wire [9:0] ram_addr;
    wire [31:0] ram_data_in;
    wire [31:0] RAM_B_douta;
    wire [31:0] counter_out;
    wire counter0_out;
    wire counter1_out;
    wire [7:0] LE_out;
    wire [31:0] Disp_num;
    wire [31:0] clkdiv;
    wire [1:0] counter_set; 
    wire [3:0] BTN_OK;
    wire counter_we;
    SCPU U1(
    .Addr_out(Addr_out[31:0]),
    .Data_in(Data_in[31:0]),
    .Data_out(Data_out[31:0]),
    .MIO_ready(1'b0),
    .MemRW(MemRW),
    .PC_out(PC[31:0]),
    .clk(Clk_CPU),
    .inst_in(inst_in[31:0]),
    .rst(rst)
    );
    ROM_D_0 U2 (
    .a(PC[11:2]), 
    .spo(inst_in) 
    );
    RAM_B U3 (
    .clka(~clk_100mhz),
    .wea(data_ram_we),
    .addra(ram_addr[9:0]),
    .dina(ram_data_in[31:0]),
    .douta(RAM_B_douta[31:0])
    );
    MIO_BUS U4(
    .clk(clk_100mhz), 
    .rst(rst), 
    .BTN(BTN_OK[3:0]), 
    .SW(SW_OK[15:0]), 
    .mem_w(MemRW), 
    .Cpu_data2bus(Data_out[31:0]), 
    .addr_bus(Addr_out[31:0]), 
    .ram_data_out(RAM_B_douta[31:0]), 
    .led_out(led_out[15:0]), 
    .counter_out(counter_out[31:0]), 
    .counter0_out(counter0_out), 
    .counter1_out(counter1_out), 
    .counter2_out(counter2_out), 
    .Cpu_data4bus(Data_in[31:0]), 
    .ram_data_in(ram_data_in[31:0]), 
    .ram_addr(ram_addr[9:0]), 
    .data_ram_we(data_ram_we), 
    .GPIOf0000000_we(GPIOf0000000_we), 
    .GPIOe0000000_we(GPIOe0000000_we), 
    .counter_we(counter_we), 
    .Peripheral_in(Peripheral_in[31:0])
    );
    Multi_8CH32 U5(
    .clk(~Clk_CPU), 
    .rst(rst), 
    .EN(GPIOe0000000_we), 
    .Test(SW_OK[7:5]), 
    .point_in({clkdiv[31:0], clkdiv[31:0]}), 
    .LES(64'b0), 
    .Data0(Peripheral_in[31:0]), 
    .data1({2'b0, PC[31:2]}), 
    .data2(inst_in[31:0]), 
    .data3(counter_out[31:0]), 
    .data4(Addr_out[31:0]), 
    .data5(Data_out[31:0]), 
    .data6(Data_in[31:0]), 
    .data7(PC[31:0]), 
    .point_out(point_out[7:0]), 
    .LE_out(LE_out[7:0]), 
    .Disp_num(Disp_num[31:0])
    );
    SSeg7_Dev_0 U6(
    .clk(clk_100mhz), 
    .flash(clkdiv[25]), 
    .Hexs(Disp_num[31:0]), 
    .LES(LE_out[7:0]), 
    .point(point_out[7:0]), 
    .rst(rst), 
    .Start(clkdiv[20]), 
    .SW0(SW_OK[0]), 
    .seg_clk(seg_clk), 
    .seg_clrn(seg_clrn), 
    .SEG_PEN(SEG_PEN), 
    .seg_sout(seg_sout)
    );
    SPIO U7(
    .clk(~Clk_CPU), 
    .rst(rst), 
    .Start(clkdiv[20]), 
    .EN(GPIOf0000000_we), 
    .P_Data(Peripheral_in), 
    .counter_set(counter_set[1:0]), 
    .LED_out(led_out), 
    .led_clk(led_clk), 
    .led_sout(led_sout), 
    .led_clrn(led_clrn), 
    .LED_PEN(LED_PEN) 
    );
    clk_div U8(
    .clk(clk_100mhz),
    .rst(rst),
    .SW2(SW_OK[2]),
    .SW8(SW_OK[8]),
    .STEP(SW_OK[10] | BTN_OK[0]),
    .clkdiv(clkdiv),
    .Clk_CPU(Clk_CPU)
    );
    SAnti_jitter U9(
    .clk(clk_100mhz),
    .RSTN(RSTN),
    .Key_y(BTN_y),
    .SW(SW),
    .BTN_OK(BTN_OK),
    .SW_OK(SW_OK),
    .rst(rst)
    );
    Counter_x U10(
    .clk(~Clk_CPU), 
    .rst(rst), 
    .clk0(clkdiv[6]), 
    .clk1(clkdiv[9]), 
    .clk2(clkdiv[11]), 
    .counter_we(counter_we),
    .counter_val(Peripheral_in),
    .counter_ch(counter_set[1:0]),
    .counter0_OUT(counter0_out), 
    .counter1_OUT(counter1_out), 
    .counter2_OUT(counter2_out), 
    .counter_out(counter_out)
    );
    VGA U11(
    .clk_25m(clkdiv[1]),
    .clk_100m(clk_100mhz),
    .rst(rst),
    .pc(PC[31:0]),
    .inst(inst_in[31:0]),
    .alu_res(Data_out[31:0]),
    .mem_wen(MemRW),
    .dmem_o_data(RAM_B_douta[31:0]),
    .dmem_i_data(ram_data_in[31:0]),
    .dmem_addr(Data_out[31:0]),
    .hs(HSYNC),
    .vs(VSYNC),
    .vga_r(Red[3:0]),
    .vga_g(Green[3:0]),
    .vga_b(Blue[3:0])
    );
endmodule
```



```verilog
// zky带debug
module CSSTE(
    input clk_100mhz,
    input RSTN,
    input [3:0] BTN_y,
    input [15:0] SW,
    output [3:0] Blue,
    output [3:0] Green,
    output [3:0] Red,
    output HSYNC,
    output VSYNC,
    output LED_PEN,
    output SEG_PEN,
    output led_clk,
    output led_clrn,
    output led_sout,
    output seg_clk,
    output seg_clrn,
    output seg_sout
);
    wire reg_wen;
    wire is_lui;
    wire MemRW;
    wire rst;
    wire data_ram_we;
    wire Clk_CPU;
    wire counter0_out;
    wire counter1_out;
    wire counter2_out;
    wire GPIOe0000000_we;
    wire GPIOf0000000_we;
    wire counter_we;

    wire [31:0] ra;
    wire [31:0] sp;
    wire [31:0] gp;
    wire [31:0] tp;
    wire [31:0] t0;
    wire [31:0] t1;
    wire [31:0] t2;
    wire [31:0] s0;
    wire [31:0] s1;
    wire [31:0] a0;
    wire [31:0] a1;
    wire [31:0] a2;
    wire [31:0] a3;
    wire [31:0] a4;
    wire [31:0] a5;
    wire [31:0] a6;
    wire [31:0] a7;
    wire [31:0] s2;
    wire [31:0] s3;
    wire [31:0] s4;
    wire [31:0] s5;
    wire [31:0] s6;
    wire [31:0] s7;
    wire [31:0] s8;
    wire [31:0] s9;
    wire [31:0] s10;
    wire [31:0] s11;
    wire [31:0] t3;
    wire [31:0] t4;
    wire [31:0] t5;
    wire [31:0] t6;
    wire [31:0] a_val;
    wire [31:0] b_val;
    wire [3:0] alu_ctrl;
    wire [31:0] alu_res;
    wire cmp_res;
    wire [31:0] pc_branch;
    wire [31:0] rs1_val;
    wire [31:0] rs2_val;
    wire [31:0] reg_i_data;
    wire [31:0] imm;
    wire [31:0] Addr_out;
    wire [31:0] Data_in;
    wire [31:0] Data_out;
    wire [31:0] PC;
    wire [31:0] inst_in;
    wire [9:0]  ram_addr;
    wire [31:0] ram_data_in;
    wire [31:0] RAM_B_douta;
    wire [31:0] clkdiv;
    wire [3:0]  BTN_OK;
    wire [15:0] SW_OK;
    wire [15:0] led_out;
    wire [31:0] counter_out;
    wire [31:0] Peripheral_in;
    wire [7:0]  point_out;
    wire [7:0]  LE_out;
    wire [31:0] Disp_num;
    wire [1:0]  counter_set;
    wire [31:0] test;
    reg do_branch;
    always@* begin
        case(inst_in[14:12])
            3'b000: do_branch = $signed(rs1_val) == $signed(rs2_val);
            3'b001: do_branch = $signed(rs1_val) != $signed(rs2_val);
            3'b100: do_branch = $signed(rs1_val) < $signed(rs2_val);
            3'b101: do_branch = $signed(rs1_val) >= $signed(rs2_val);
            3'b110: do_branch = $unsigned(rs1_val) < $unsigned(rs2_val);
            3'b111: do_branch = $unsigned(rs1_val) >= $unsigned(rs2_val);
        endcase
    end
    wire is_branch;
    wire is_jal;
    wire is_jalr;
    wire is_imm;
    assign is_branch = (inst_in[6:0] == 7'b1100011);
    assign is_jal = (inst_in[6:0] == 7'b1101111);
    assign is_jalr = (inst_in[6:0] == 7'b1100111);
    assign is_imm = (inst_in[6:0] == 7'b0010011);
    assign is_lui = (inst_in[6:0] == 7'b0110111);
    SCPU U1(
        .Addr_out(Addr_out[31:0]),
        .Data_in(Data_in[31:0]),
        .Data_out(Data_out[31:0]),
        .MIO_ready(1'b0),
        .MemRW(MemRW),
        .PC_out(PC[31:0]),
        .clk(Clk_CPU),
        //.clk(clk_100mhz),
        .inst_in(inst_in[31:0]),
        .a_val(a_val),
        .b_val(b_val),
        .alu_ctrl(alu_ctrl),
        .alu_res(alu_res),
        .cmp_res(cmp_res),
        .rs1_val(rs1_val),
        .rs2_val(rs2_val),
        .reg_i_data(reg_i_data),
        .reg_wen(reg_wen),
        .pc_branch(pc_branch),
        .imm(imm),
        .rst(rst),
        .ra(ra),
        .sp(sp),
        .gp(gp),
        .tp(tp),
        .t0(t0),
        .t1(t1),
        .t2(t2),
        .s0(s0),
        .s1(s1),
        .a0(a0),
        .a1(a1),
        .a2(a2),
        .a3(a3),
        .a4(a4),
        .a5(a5),
        .a6(a6),
        .a7(a7),
        .s2(s2),
        .s3(s3),
        .s4(s4),
        .s5(s5),
        .s6(s6),
        .s7(s7),
        .s8(s8),
        .s9(s9),
        .s10(s10),
        .s11(s11),
        .t3(t3),
        .t4(t4),
        .t5(t5),
        .t6(t6),
        .test(test)
    );
    ROM_D U2 (
        .a(PC[11:2]),    
        .spo(inst_in)
    );
    RAM_B U3 (
        .clka(~clk_100mhz),
        .wea(data_ram_we),
        .addra(ram_addr[9:0]),
        .dina(ram_data_in[31:0]),
        .douta(RAM_B_douta[31:0])
    );
    MIO_BUS U4(
        .GPIOf0000000_we(GPIOf0000000_we), 
        .GPIOe0000000_we(GPIOe0000000_we), 
        .counter_we(counter_we), 
        .clk(clk_100mhz), 
        .rst(rst), 
        .BTN(BTN_OK[3:0]), 
        .SW(SW_OK[15:0]), 
        .mem_w(MemRW), 
        .Cpu_data2bus(Data_out[31:0]), 
        .addr_bus(Addr_out[31:0]), 
        .ram_data_out(RAM_B_douta[31:0]), 
        .led_out(led_out[15:0]), 
        .counter_out(counter_out[31:0]), 
        .counter0_out(counter0_out), 
        .counter1_out(counter1_out), 
        .counter2_out(counter2_out), 
        .Cpu_data4bus(Data_in[31:0]), 
        .ram_data_in(ram_data_in[31:0]), 
        .ram_addr(ram_addr[9:0]), 
        .data_ram_we(data_ram_we), 
        .Peripheral_in(Peripheral_in[31:0])
    );
    Multi_8CH32 U5(
        .Data0(Peripheral_in[31:0]), 
        .data1({2'b0, PC[31:2]}), 
        .data2(inst_in[31:0]), 
        .data3(counter_out[31:0]), 
        .data4(Addr_out[31:0]), 
        .data5(Data_out[31:0]), 
        .data6(Data_in[31:0]), 
        .data7(PC[31:0]), 
        .clk(~Clk_CPU), 
        //.clk(clk_100mhz),
        .rst(rst), 
        .EN(GPIOe0000000_we), 
        .Test(SW_OK[7:5]), 
        .point_in({clkdiv[31:0], clkdiv[31:0]}), 
        .LES(64'b0), 
        .point_out(point_out[7:0]), 
        .LE_out(LE_out[7:0]), 
        .Disp_num(Disp_num[31:0])
    );
    SSeg7_Dev U6(
        .flash(clkdiv[25]), 
        .Hexs(Disp_num[31:0]), 
        .LES(LE_out[7:0]), 
        .point(point_out[7:0]), 
        .rst(rst), 
        .Start(clkdiv[20]), 
        .SW0(SW_OK[0]), 
        .seg_clk(seg_clk), 
        .seg_clrn(seg_clrn), 
        .SEG_PEN(SEG_PEN), 
        .clk(clk_100mhz), 
        .seg_sout(seg_sout)
    );
    SPIO U7(
        .LED_out(led_out), 
        .led_clk(led_clk), 
        .led_sout(led_sout), 
        .led_clrn(led_clrn), 
        .LED_PEN(LED_PEN) ,
        .clk(~Clk_CPU), 
        .rst(rst), 
        .Start(clkdiv[20]), 
        .EN(GPIOf0000000_we), 
        .P_Data(Peripheral_in), 
        .counter_set(counter_set[1:0])
    );
    clk_div U8(
        .clk(clk_100mhz),
        .rst(rst),
        .SW2(SW_OK[2]),
        .SW8(SW_OK[8]),
        .STEP(SW_OK[10] | BTN_OK[0]),
        .clkdiv(clkdiv),
        .Clk_CPU(Clk_CPU)
    );
    SAnti_jitter U9(
        .clk(clk_100mhz),
        .RSTN(RSTN),
        .Key_y(BTN_y),
        .SW(SW),
        .BTN_OK(BTN_OK),
        .SW_OK(SW_OK),
        .rst(rst)
    );
    Counter_x U10(
        //.clk(clk_100mhz),
        .clk(~Clk_CPU), 
        .rst(rst), 
        .clk0(clkdiv[6]), 
        .clk1(clkdiv[9]), 
        .clk2(clkdiv[11]), 
        .counter_we(counter_we),
        .counter_val(Peripheral_in),
        .counter_ch(counter_set[1:0]),
        .counter0_OUT(counter0_out), 
        .counter1_OUT(counter1_out), 
        .counter2_OUT(counter2_out), 
        .counter_out(counter_out)
    );
    VGA U11(
        .ra(ra),
        .sp(sp),
        .gp(gp),
        .tp(tp),
        .t0(t0),
        .t1(t1),
        .t2(t2),
        .s0(s0),
        .s1(s1),
        .a0(a0),
        .a1(a1),
        .a2(a2),
        .a3(a3),
        .a4(a4),
        .a5(a5),
        .a6(a6),
        .a7(a7),
        .s2(s2),
        .s3(s3),
        .s4(s4),
        .s5(s5),
        .s6(s6),
        .s7(s7),
        .s8(s8),
        .s9(s9),
        .s10(s10),
        .s11(s11),
        .t3(t3),
        .t4(t4),
        .t5(t5),
        .t6(t6),
        .clk_25m(clkdiv[1]),
        .clk_100m(clk_100mhz),
        .rst(rst),
        .pc(PC[31:0]),
        .inst(inst_in[31:0]),
        .mem_wen(MemRW),
        .mem_ren(~MemRW),
        .dmem_o_data(RAM_B_douta[31:0]),
        .dmem_i_data(ram_data_in[31:0]),
        .dmem_addr(ram_addr[9:0]),
        .hs(HSYNC),
        .vs(VSYNC),
        .vga_r(Red[3:0]),
        .vga_g(Green[3:0]),
        .vga_b(Blue[3:0]),
        .a_val(a_val),
        .b_val(b_val),
        .alu_ctrl(alu_ctrl),
        .alu_res(alu_res),
        .cmp_res(cmp_res),
        .rs1(inst_in[19:15]),
        .rs1_val(rs1_val),
        .rs2(inst_in[24:20]),
        .rs2_val(rs2_val),
        .rd(inst_in[11:7]),
        .reg_i_data(reg_i_data),
        .reg_wen(reg_wen),
        .is_branch(is_branch),
        .is_jal(is_jal),
        .is_jalr(is_jalr),
        .do_branch(do_branch),
        .pc_branch(pc_branch),
        .imm(imm),
        .is_imm (is_imm),
        .is_lui(is_lui),
        .mcause_o(inst_in[6:0]),
        .mstatus_o(test)
    );
endmodule
```

```verilog
//原VGA.v
module VGA(clk_25m, clk_100m, rst, pc, inst, alu_res, mem_wen, 
  dmem_o_data, dmem_i_data, dmem_addr, hs, vs, vga_r, vga_g, vga_b)
/* synthesis syn_black_box black_box_pad_pin="clk_25m,clk_100m,rst,pc[31:0],inst[31:0],alu_res[31:0],mem_wen,dmem_o_data[31:0],dmem_i_data[31:0],dmem_addr[31:0],hs,vs,vga_r[3:0],vga_g[3:0],vga_b[3:0]" */;
  input clk_25m;
  input clk_100m;
  input rst;
  input [31:0]pc;
  input [31:0]inst;
  input [31:0]alu_res;
  input mem_wen;
  input [31:0]dmem_o_data;
  input [31:0]dmem_i_data;
  input [31:0]dmem_addr;
  output hs;
  output vs;
  output [3:0]vga_r;
  output [3:0]vga_g;
  output [3:0]vga_b;
endmodule
```

```verilog
// 我自己填的
`timescale 1ns / 1ps
module VGA(
   input wire clk_25m, 
   input wire clk_100m, 
   input wire rst,
   input wire [31:0] pc,
   input wire [31:0] inst,
   input wire [31:0] alu_res,
   input wire mem_wen,
   input wire [31:0] dmem_o_data,
   input wire [31:0] dmem_i_data,
   input wire [31:0] dmem_addr,
   output wire hs,
   output wire vs,
   output wire [3:0] vga_r,
   output wire [3:0] vga_g,
   output wire [3:0] vga_b,
    // added for debug
   input [4:0] rs1,
   input [31:0] rs1_val,
   input [4:0] rs2,
   input [31:0] rs2_val,
   input [4:0] rd,
   input [31:0] reg_i_data,
   input reg_wen,
   input is_imm,
   input is_auipc,
   input is_lui,
   input [31:0] imm,
   input [31:0] a_val,
   input [31:0] b_val,
   input [3:0] alu_ctrl,
   input [2:0] cmp_ctrl,
   input cmp_res,
   input is_branch,
   input is_jal,
   input is_jalr,
   input do_branch,
   input [31:0] pc_branch,
   input mem_ren,
   input csr_wen,
   input [11:0] csr_ind,
   input [1:0] csr_ctrl,
   input [31:0] csr_r_data,
   input [31:0] x0,
   input [31:0] ra,
   input [31:0] sp,
   input [31:0] gp,
   input [31:0] tp,
   input [31:0] t0,
   input [31:0] t1,
   input [31:0] t2,
   input [31:0] s0,
   input [31:0] s1,
   input [31:0] a0,
   input [31:0] a1,
   input [31:0] a2,
   input [31:0] a3,
   input [31:0] a4,
   input [31:0] a5,
   input [31:0] a6,
   input [31:0] a7,
   input [31:0] s2,
   input [31:0] s3,
   input [31:0] s4,
   input [31:0] s5,
   input [31:0] s6,
   input [31:0] s7,
   input [31:0] s8,
   input [31:0] s9,
   input [31:0] s10,
   input [31:0] s11,
   input [31:0] t3,
   input [31:0] t4,
   input [31:0] t5,
   input [31:0] t6,
   input [31:0] mstatus_o,
   input [31:0] mcause_o,
   input [31:0] mepc_o,
   input [31:0] mtval_o,
   input [31:0] mtvec_o,
   input [31:0] mie_o,
   input [31:0] mip_o
   );
   wire [9:0] vga_x;
   wire [8:0] vga_y;
   wire video_on;
   VgaController vga_controller(
      .clk          (clk_25m      ),
      //xzy: .clk(clk_div[1])
      .rst          (rst          ),
      .vga_x        (vga_x        ),
      .vga_y        (vga_y        ),
      .hs           (hs           ),
      .vs           (vs           ),
      .video_on     (video_on     )
      );
   wire display_wen;
   wire [11:0] display_w_addr;
   wire [7:0] display_w_data;
   VgaDisplay vga_display(
      .clk          (clk_100m),   ////xzy: .clk(clk_div[0])
      .video_on     (video_on),
      .vga_x        (vga_x),
      .vga_y        (vga_y),
      .vga_r        (vga_r),
      .vga_g        (vga_g),
      .vga_b        (vga_b),
      .wen          (display_wen   ),
      .w_addr       (display_w_addr),
      .w_data       (display_w_data)
   );
   VgaDebugger vga_debugger(
      .clk           (clk_100m      ), //xzy: .clk(clk_div[0])
      .display_wen   (display_wen   ),
      .display_w_addr(display_w_addr),
      .display_w_data(display_w_data),
      .pc            (pc             ),
      .inst          (inst           ),
      .rs1           (rs1               ),
      .rs1_val       (rs1_val           ),
      .rs2(rs2),
      .rs2_val(rs2_val),
      .rd(rd),
      .reg_i_data(reg_i_data),
      .reg_wen(reg_wen),
      .is_imm(is_imm),
      .is_auipc(is_auipc),
      .is_lui(is_lui),
      .imm(imm),
      .a_val(a_val),
      .b_val(b_val),
      .alu_ctrl(alu_ctrl),
      .cmp_ctrl(cmp_ctrl),
      .alu_res(alu_res),
      .cmp_res(cmp_res),
      .is_branch(is_branch),
      .is_jal(is_jal),
      .is_jalr(is_jalr),
      .do_branch(do_branch),
      .pc_branch(pc_branch),
      .mem_wen(mem_wen),
      .mem_ren(mem_ren),
      .dmem_o_data(dmem_o_data),
      .dmem_i_data(dmem_i_data),
      .dmem_addr(dmem_addr),
      .csr_wen(csr_wen),
      .csr_ind(csr_ind),
      .csr_ctrl(csr_ctrl),
      .csr_r_data(csr_r_data),
      .x0(x0),
      .ra(ra),
      .sp(sp),
      .gp(gp),
      .tp(tp),
      .t0(t0),
      .t1(t1),
      .t2(t2),
      .s0(s0),
      .s1(s1),
      .a0(a0),
      .a1(a1),
      .a2(a2),
      .a3(a3),
      .a4(a4),
      .a5(a5),
      .a6(a6),
      .a7(a7),
      .s2(s2),
      .s3(s3),
      .s4(s4),
      .s5(s5),
      .s6(s6),
      .s7(s7),
      .s8(s8),
      .s9(s9),
      .s10(s10),
      .s11(s11),
      .t3(t3),
      .t4(t4),
      .t5(t5),
      .t6(t6),
      .mstatus_o(mstatus_o),
      .mcause_o(mcause_o),
      .mepc_o(mepc_o),
      .mtval_o(mtval_o),
      .mtvec_o(mtvec_o),
      .mie_o(mie_o),
      .mip_o(mip_o)
   );
endmodule

```



# 我的最终版

### VGA

```verilog
//原VGA.V
module VGA(clk_25m, clk_100m, rst, pc, inst, alu_res, mem_wen, 
  dmem_o_data, dmem_i_data, dmem_addr, hs, vs, vga_r, vga_g, vga_b)
/* synthesis syn_black_box black_box_pad_pin="clk_25m,clk_100m,rst,pc[31:0],inst[31:0],alu_res[31:0],mem_wen,dmem_o_data[31:0],dmem_i_data[31:0],dmem_addr[31:0],hs,vs,vga_r[3:0],vga_g[3:0],vga_b[3:0]" */;
  input clk_25m;
  input clk_100m;
  input rst;
  input [31:0]pc;
  input [31:0]inst;
  input [31:0]alu_res;
  input mem_wen;
  input [31:0]dmem_o_data;
  input [31:0]dmem_i_data;
  input [31:0]dmem_addr;
  output hs;
  output vs;
  output [3:0]vga_r;
  output [3:0]vga_g;
  output [3:0]vga_b;
endmodule
```

```VERILOG
// 修改后的VGA.v
`timescale 1ns / 1ps
module VGA(
   input wire clk_25m, 
   input wire clk_100m, 
   input wire rst,
   input wire [31:0] pc,
   input wire [31:0] inst,
   input wire [31:0] alu_res,
   input wire mem_wen,
   input wire [31:0] dmem_o_data,
   input wire [31:0] dmem_i_data,
   input wire [31:0] dmem_addr,
   output wire hs,
   output wire vs,
   output wire [3:0] vga_r,
   output wire [3:0] vga_g,
   output wire [3:0] vga_b,
    // added for debug
   input [4:0] rs1,
   input [31:0] rs1_val,
   input [4:0] rs2,
   input [31:0] rs2_val,
   input [4:0] rd,
   input [31:0] reg_i_data,
   input reg_wen,
   input is_imm,
   input is_auipc,
   input is_lui,
   input [31:0] imm,
   input [31:0] a_val,
   input [31:0] b_val,
   input [3:0] alu_ctrl,
   input [2:0] cmp_ctrl,
   input cmp_res,
   input is_branch,
   input is_jal,
   input is_jalr,
   input do_branch,
   input [31:0] pc_branch,
   input mem_ren,
   input csr_wen,
   input [11:0] csr_ind,
   input [1:0] csr_ctrl,
   input [31:0] csr_r_data,
   input [31:0] x0,
   input [31:0] ra,
   input [31:0] sp,
   input [31:0] gp,
   input [31:0] tp,
   input [31:0] t0,
   input [31:0] t1,
   input [31:0] t2,
   input [31:0] s0,
   input [31:0] s1,
   input [31:0] a0,
   input [31:0] a1,
   input [31:0] a2,
   input [31:0] a3,
   input [31:0] a4,
   input [31:0] a5,
   input [31:0] a6,
   input [31:0] a7,
   input [31:0] s2,
   input [31:0] s3,
   input [31:0] s4,
   input [31:0] s5,
   input [31:0] s6,
   input [31:0] s7,
   input [31:0] s8,
   input [31:0] s9,
   input [31:0] s10,
   input [31:0] s11,
   input [31:0] t3,
   input [31:0] t4,
   input [31:0] t5,
   input [31:0] t6,
   input [31:0] mstatus_o,
   input [31:0] mcause_o,
   input [31:0] mepc_o,
   input [31:0] mtval_o,
   input [31:0] mtvec_o,
   input [31:0] mie_o,
   input [31:0] mip_o
   );
   wire [9:0] vga_x;
   wire [8:0] vga_y;
   wire video_on;
   VgaController vga_controller(
      .clk          (clk_25m      ),
      //xzy: .clk(clk_div[1])
      .rst          (rst          ),
      .vga_x        (vga_x        ),
      .vga_y        (vga_y        ),
      .hs           (hs           ),
      .vs           (vs           ),
      .video_on     (video_on     )
      );
   wire display_wen;
   wire [11:0] display_w_addr;
   wire [7:0] display_w_data;
   VgaDisplay vga_display(
      .clk          (clk_100m),   ////xzy: .clk(clk_div[0])
      .video_on     (video_on),
      .vga_x        (vga_x),
      .vga_y        (vga_y),
      .vga_r        (vga_r),
      .vga_g        (vga_g),
      .vga_b        (vga_b),
      .wen          (display_wen   ),
      .w_addr       (display_w_addr),
      .w_data       (display_w_data)
   );
   VgaDebugger vga_debugger(
      .clk           (clk_100m      ), //xzy: .clk(clk_div[0])
      .display_wen   (display_wen   ),
      .display_w_addr(display_w_addr),
      .display_w_data(display_w_data),
      .pc            (pc             ),
      .inst          (inst           ),
      .rs1           (rs1               ),
      .rs1_val       (rs1_val           ),
      .rs2(rs2),
      .rs2_val(rs2_val),
      .rd(rd),
      .reg_i_data(reg_i_data),
      .reg_wen(reg_wen),
      .is_imm(is_imm),
      .is_auipc(is_auipc),
      .is_lui(is_lui),
      .imm(imm),
      .a_val(a_val),
      .b_val(b_val),
      .alu_ctrl(alu_ctrl),
      .cmp_ctrl(cmp_ctrl),
      .alu_res(alu_res),
      .cmp_res(cmp_res),
      .is_branch(is_branch),
      .is_jal(is_jal),
      .is_jalr(is_jalr),
      .do_branch(do_branch),
      .pc_branch(pc_branch),
      .mem_wen(mem_wen),
      .mem_ren(mem_ren),
      .dmem_o_data(dmem_o_data),
      .dmem_i_data(dmem_i_data),
      .dmem_addr(dmem_addr),
      .csr_wen(csr_wen),
      .csr_ind(csr_ind),
      .csr_ctrl(csr_ctrl),
      .csr_r_data(csr_r_data),
      .x0(x0),
      .ra(ra),
      .sp(sp),
      .gp(gp),
      .tp(tp),
      .t0(t0),
      .t1(t1),
      .t2(t2),
      .s0(s0),
      .s1(s1),
      .a0(a0),
      .a1(a1),
      .a2(a2),
      .a3(a3),
      .a4(a4),
      .a5(a5),
      .a6(a6),
      .a7(a7),
      .s2(s2),
      .s3(s3),
      .s4(s4),
      .s5(s5),
      .s6(s6),
      .s7(s7),
      .s8(s8),
      .s9(s9),
      .s10(s10),
      .s11(s11),
      .t3(t3),
      .t4(t4),
      .t5(t5),
      .t6(t6),
      .mstatus_o(mstatus_o),
      .mcause_o(mcause_o),
      .mepc_o(mepc_o),
      .mtval_o(mtval_o),
      .mtvec_o(mtvec_o),
      .mie_o(mie_o),
      .mip_o(mip_o)
   );
endmodule
```

### 顶层

```verilog
// 原顶层（教师版）
`timescale 1ns / 1ps
//////////////////////////////////////////////////////////////////////////////////
// Company: 
// Engineer: 
// 
// Create Date: 2022/03/02 15:40:21
// Design Name: 
// Module Name: CSSTE
// Project Name: 
// Target Devices: 
// Tool Versions: 
// Description: 
// 
// Dependencies: 
// 
// Revision:
// Revision 0.01 - File Created
// Additional Comments:
// 
//////////////////////////////////////////////////////////////////////////////////
// 原教师版顶层文件
module CSSTE(
    input         clk_100mhz,
    input         RSTN,
    input  [3:0]  BTN_y,
    input  [15:0] SW,
    output [3:0]  Blue,
    output [3:0]  Green,
    output [3:0]  Red,
    output        HSYNC,
    output        VSYNC,
    output        LED_PEN,
    output        SEG_PEN,
    output        led_clk,
    output        led_clrn,
    output        led_sout,
    output        seg_clk,
    output        seg_clrn,
    output        seg_sout
    );
    wire [3:0] BTN_OK;
    wire [15:0] SW_OK;
    wire        rst;
    wire        Clk_CPU;
    wire [31:0] clkdiv;
    wire [31:0] Addr_out;
    wire [31:0] Data_out;
    wire [31:0] PC_out;
    wire        MemRW;
    wire [31:0] Inst_in;
    wire [31:0] Data_in;
    wire [9:0]  ram_addr;
    wire [31:0] ram_data_in;
    wire [31:0] RAM_B_0_douta;
    wire [31:0] U4_data_ram_we;
    wire        U4_GPIOe0000000_we;
    wire        U4_GPIOf0000000_we;
    wire [31:0] U4_Peripheral_in;
    wire        U10_counter0_OUT;
    wire        U10_counter1_OUT;
    wire        U10_counter2_OUT;
    wire [31:0] U10_counter_out;
    wire        U4_counter_we;
    wire [15:0] U7_LED_out;
    SCPU U1(.Addr_out(Addr_out),
        .Data_in(Data_in),
        .Data_out(Data_out),
        .MIO_ready(1'b0),
        .MemRW(MemRW),
        .PC_out(PC_out),
        .clk(Clk_CPU),
        .inst_in(Inst_in),
        .rst(rst));
    ROM_D_0 U2(.a(PC_out[11:2]),
        .spo(Inst_in));
    RAM_B U3(.addra(ram_addr),
        .clka(~clk_100mhz),
        .dina(ram_data_in),
        .douta(RAM_B_0_douta),
        .wea(U4_data_ram_we));
    MIO_BUS U4(.BTN(BTN_OK),
        .Cpu_data2bus(Data_out),
        .Cpu_data4bus(Data_in),
        .GPIOe0000000_we(U4_GPIOe0000000_we),
        .GPIOf0000000_we(U4_GPIOf0000000_we),
        .Peripheral_in(U4_Peripheral_in),
        .SW(SW_OK),
        .addr_bus(Addr_out),
        .clk(clk_100mhz),
        .counter0_out(U10_counter0_OUT),
        .counter1_out(U10_counter1_OUT),
        .counter2_out(U10_counter2_OUT),
        .counter_out(U10_counter_out),
        .counter_we(U4_counter_we),
        .data_ram_we(U4_data_ram_we),
        .led_out(U7_LED_out),
        .mem_w(MemRW),
        .ram_addr(ram_addr),
        .ram_data_in(ram_data_in),
        .ram_data_out(RAM_B_0_douta),
        .rst(rst));
    wire [31:0] Multi_8CH32_0_Disp_num;
    wire [7:0]  Multi_8CH32_0_LE_out;
    wire [7:0]  Multi_8CH32_0_point_out;
    Multi_8CH32 U5(.Data0(U4_Peripheral_in),
        .Disp_num(Multi_8CH32_0_Disp_num),
        .EN(U4_GPIOe0000000_we),
        .LES(64'b0),
        .LE_out(Multi_8CH32_0_LE_out),
        .Test(SW_OK[7:5]),
        .clk(~Clk_CPU),
        .data1({2'b0,PC_out[31:2]}),
        .data2(Inst_in),
        .data3(U10_counter_out),
        .data4(Addr_out),
        .data5(Data_out),
        .data6(Data_in),
        .data7(PC_out),
        .point_in({clkdiv[31:0],clkdiv[31:0]}),
        .point_out(Multi_8CH32_0_point_out),
        .rst(rst));
    SSeg7_Dev_0 U6(.Hexs(Multi_8CH32_0_Disp_num),
        .LES(Multi_8CH32_0_LE_out),
        .SEG_PEN(SEG_PEN),
        .SW0(SW_OK[0]),
        .Start(clkdiv[20]),
        .clk(clk_100mhz),
        .flash(clkdiv[25]),
        .point(Multi_8CH32_0_point_out),
        .rst(rst),
        .seg_clk(seg_clk),
        .seg_clrn(seg_clrn),
        .seg_sout(seg_sout));
    wire [1:0] U7_counter_set;
    SPIO U7(.EN(U4_GPIOf0000000_we),
        .LED_PEN(LED_PEN),
        .LED_out(U7_LED_out),
        .P_Data(U4_Peripheral_in),
        .Start(clkdiv[20]),
        .clk(~Clk_CPU),
        .counter_set(U7_counter_set),
        .led_clk(led_clk),
        .led_clrn(led_clrn),
        .led_sout(led_sout),
        .rst(rst));
    clk_div U8(.Clk_CPU(Clk_CPU),
        .STEP(BTN_OK[0]|SW_OK[10]),
        .SW2(SW_OK[2]),
        .SW8(SW_OK[8]),
        .clk(clk_100mhz),
        .clkdiv(clkdiv),
        .rst(rst));
    SAnti_jitter U9(.BTN_OK(BTN_OK),
        .Key_y(BTN_y),
        .RSTN(RSTN),
        .SW(SW),
        .SW_OK(SW_OK),
        .clk(clk_100mhz),
        .readn(1'b0),
        .rst(rst));
    Counter_x U10(.clk(~Clk_CPU),
                .clk0(clkdiv[6]),
                .clk1(clkdiv[9]),
                .clk2(clkdiv[11]),
                .counter0_OUT(U10_counter0_OUT),
                .counter1_OUT(U10_counter1_OUT),
                .counter2_OUT(U10_counter2_OUT),
                .counter_ch(U7_counter_set),
                .counter_out(U10_counter_out),
                .counter_val(U4_Peripheral_in),
                .counter_we(U4_counter_we),
                .rst(rst));
    VGA U11(.alu_res(Addr_out),
        .clk_100m(clk_100mhz),
        .clk_25m(clkdiv[1]),
        .dmem_addr(Addr_out),
        .dmem_i_data(ram_data_in),
        .dmem_o_data(RAM_B_0_douta),
        .hs(HSYNC),
        .inst(Inst_in),
        .mem_wen(MemRW),
        .pc(PC_out),
        .rst(rst),
        .vga_b(Blue),
        .vga_g(Green),
        .vga_r(Red),
        .vs(VSYNC));
endmodule
```

```verilog
// 修改后的顶层
// 这个是抄了zky的lab4 单周期实验报告中的内容
module CSSTE(
    input clk_100mhz,
    input RSTN,
    input [3:0] BTN_y,
    input [15:0] SW,
    output [3:0] Blue,
    output [3:0] Green,
    output [3:0] Red,
    output HSYNC,
    output VSYNC,
    output LED_PEN,
    output SEG_PEN,
    output led_clk,
    output led_clrn,
    output led_sout,
    output seg_clk,
    output seg_clrn,
    output seg_sout
);
    wire reg_wen;
    wire is_lui;
    wire MemRW;
    wire rst;
    wire data_ram_we;
    wire Clk_CPU;
    wire counter0_out;
    wire counter1_out;
    wire counter2_out;
    wire GPIOe0000000_we;
    wire GPIOf0000000_we;
    wire counter_we;
    wire [31:0] ra;
    wire [31:0] sp;
    wire [31:0] gp;
    wire [31:0] tp;
    wire [31:0] t0;
    wire [31:0] t1;
    wire [31:0] t2;
    wire [31:0] s0;
    wire [31:0] s1;
    wire [31:0] a0;
    wire [31:0] a1;
    wire [31:0] a2;
    wire [31:0] a3;
    wire [31:0] a4;
    wire [31:0] a5;
    wire [31:0] a6;
    wire [31:0] a7;
    wire [31:0] s2;
    wire [31:0] s3;
    wire [31:0] s4;
    wire [31:0] s5;
    wire [31:0] s6;
    wire [31:0] s7;
    wire [31:0] s8;
    wire [31:0] s9;
    wire [31:0] s10;
    wire [31:0] s11;
    wire [31:0] t3;
    wire [31:0] t4;
    wire [31:0] t5;
    wire [31:0] t6;
    wire [31:0] a_val;
    wire [31:0] b_val;
    wire [3:0] alu_ctrl;
    wire [31:0] alu_res;
    wire cmp_res;
    wire [31:0] pc_branch;
    wire [31:0] rs1_val;
    wire [31:0] rs2_val;
    wire [31:0] reg_i_data;
    wire [31:0] imm;
    wire [31:0] Addr_out;
    wire [31:0] Data_in;
    wire [31:0] Data_out;
    wire [31:0] PC;
    wire [31:0] inst_in;
    wire [9:0]  ram_addr;
    wire [31:0] ram_data_in;
    wire [31:0] RAM_B_douta;
    wire [31:0] clkdiv;
    wire [3:0]  BTN_OK;
    wire [15:0] SW_OK;
    wire [15:0] led_out;
    wire [31:0] counter_out;
    wire [31:0] Peripheral_in;
    wire [7:0]  point_out;
    wire [7:0]  LE_out;
    wire [31:0] Disp_num;
    wire [1:0]  counter_set;
    wire [31:0] test;
    reg do_branch;
    always@* begin
        case(inst_in[14:12])
            3'b000: do_branch = $signed(rs1_val) == $signed(rs2_val);
            3'b001: do_branch = $signed(rs1_val) != $signed(rs2_val);
            3'b100: do_branch = $signed(rs1_val) < $signed(rs2_val);
            3'b101: do_branch = $signed(rs1_val) >= $signed(rs2_val);
            3'b110: do_branch = $unsigned(rs1_val) < $unsigned(rs2_val);
            3'b111: do_branch = $unsigned(rs1_val) >= $unsigned(rs2_val);
        endcase
    end
    wire is_branch;
    wire is_jal;
    wire is_jalr;
    wire is_imm;
    assign is_branch = (inst_in[6:0] == 7'b1100011);
    assign is_jal = (inst_in[6:0] == 7'b1101111);
    assign is_jalr = (inst_in[6:0] == 7'b1100111);
    assign is_imm = (inst_in[6:0] == 7'b0010011);
    assign is_lui = (inst_in[6:0] == 7'b0110111);
    SCPU U1(
        .Addr_out(Addr_out[31:0]),
        .Data_in(Data_in[31:0]),
        .Data_out(Data_out[31:0]),
        .MIO_ready(1'b0),
        .MemRW(MemRW),
        .PC_out(PC[31:0]),
        .clk(Clk_CPU),
        .inst_in(inst_in[31:0]),
        .a_val(a_val),
        .b_val(b_val),
        .alu_ctrl(alu_ctrl),
        .alu_res(alu_res),
        .cmp_res(cmp_res),
        .rs1_val(rs1_val),
        .rs2_val(rs2_val),
        .reg_i_data(reg_i_data),
        .reg_wen(reg_wen),
        .pc_branch(pc_branch),
        .imm(imm),
        .rst(rst),
        .ra(ra),
        .sp(sp),
        .gp(gp),
        .tp(tp),
        .t0(t0),
        .t1(t1),
        .t2(t2),
        .s0(s0),
        .s1(s1),
        .a0(a0),
        .a1(a1),
        .a2(a2),
        .a3(a3),
        .a4(a4),
        .a5(a5),
        .a6(a6),
        .a7(a7),
        .s2(s2),
        .s3(s3),
        .s4(s4),
        .s5(s5),
        .s6(s6),
        .s7(s7),
        .s8(s8),
        .s9(s9),
        .s10(s10),
        .s11(s11),
        .t3(t3),
        .t4(t4),
        .t5(t5),
        .t6(t6),
        .test(test)
    );
    ROM_D U2 (
        .a(PC[11:2]),    
        .spo(inst_in)
    );
    RAM_B U3 (
        .clka(~clk_100mhz),
        .wea(data_ram_we),
        .addra(ram_addr[9:0]),
        .dina(ram_data_in[31:0]),
        .douta(RAM_B_douta[31:0])
    );
    MIO_BUS U4(
        .GPIOf0000000_we(GPIOf0000000_we), 
        .GPIOe0000000_we(GPIOe0000000_we), 
        .counter_we(counter_we), 
        .clk(clk_100mhz), 
        .rst(rst), 
        .BTN(BTN_OK[3:0]), 
        .SW(SW_OK[15:0]), 
        .mem_w(MemRW), 
        .Cpu_data2bus(Data_out[31:0]), 
        .addr_bus(Addr_out[31:0]), 
        .ram_data_out(RAM_B_douta[31:0]), 
        .led_out(led_out[15:0]), 
        .counter_out(counter_out[31:0]), 
        .counter0_out(counter0_out), 
        .counter1_out(counter1_out), 
        .counter2_out(counter2_out), 
        .Cpu_data4bus(Data_in[31:0]), 
        .ram_data_in(ram_data_in[31:0]), 
        .ram_addr(ram_addr[9:0]), 
        .data_ram_we(data_ram_we), 
        .Peripheral_in(Peripheral_in[31:0])
    );
    Multi_8CH32 U5(
        .Data0(Peripheral_in[31:0]), 
        .data1({2'b0, PC[31:2]}), 
        .data2(inst_in[31:0]), 
        .data3(counter_out[31:0]), 
        .data4(Addr_out[31:0]), 
        .data5(Data_out[31:0]), 
        .data6(Data_in[31:0]), 
        .data7(PC[31:0]), 
        .clk(~Clk_CPU), 
        .rst(rst), 
        .EN(GPIOe0000000_we), 
        .Test(SW_OK[7:5]), 
        .point_in({clkdiv[31:0], clkdiv[31:0]}), 
        .LES(64'b0), 
        .point_out(point_out[7:0]), 
        .LE_out(LE_out[7:0]), 
        .Disp_num(Disp_num[31:0])
    );
    SSeg7_Dev U6(
        .flash(clkdiv[25]), 
        .Hexs(Disp_num[31:0]), 
        .LES(LE_out[7:0]), 
        .point(point_out[7:0]), 
        .rst(rst), 
        .Start(clkdiv[20]), 
        .SW0(SW_OK[0]), 
        .seg_clk(seg_clk), 
        .seg_clrn(seg_clrn), 
        .SEG_PEN(SEG_PEN), 
        .clk(clk_100mhz), 
        .seg_sout(seg_sout)
    );
    SPIO U7(
        .LED_out(led_out), 
        .led_clk(led_clk), 
        .led_sout(led_sout), 
        .led_clrn(led_clrn), 
        .LED_PEN(LED_PEN) ,
        .clk(~Clk_CPU), 
        .rst(rst), 
        .Start(clkdiv[20]), 
        .EN(GPIOf0000000_we), 
        .P_Data(Peripheral_in), 
        .counter_set(counter_set[1:0])
    );
    clk_div U8(
        .clk(clk_100mhz),
        .rst(rst),
        .SW2(SW_OK[2]),
        .SW8(SW_OK[8]),
        .STEP(SW_OK[10] | BTN_OK[0]),
        .clkdiv(clkdiv),
        .Clk_CPU(Clk_CPU)
    );
    SAnti_jitter U9(
        .clk(clk_100mhz),
        .RSTN(RSTN),
        .Key_y(BTN_y),
        .SW(SW),
        .BTN_OK(BTN_OK),
        .SW_OK(SW_OK),
        .rst(rst)
    );
    Counter_x U10(
        .clk(~Clk_CPU), 
        .rst(rst), 
        .clk0(clkdiv[6]), 
        .clk1(clkdiv[9]), 
        .clk2(clkdiv[11]), 
        .counter_we(counter_we),
        .counter_val(Peripheral_in),
        .counter_ch(counter_set[1:0]),
        .counter0_OUT(counter0_out), 
        .counter1_OUT(counter1_out), 
        .counter2_OUT(counter2_out), 
        .counter_out(counter_out)
    );
    VGA U11(
        .ra(ra),
        .sp(sp),
        .gp(gp),
        .tp(tp),
        .t0(t0),
        .t1(t1),
        .t2(t2),
        .s0(s0),
        .s1(s1),
        .a0(a0),
        .a1(a1),
        .a2(a2),
        .a3(a3),
        .a4(a4),
        .a5(a5),
        .a6(a6),
        .a7(a7),
        .s2(s2),
        .s3(s3),
        .s4(s4),
        .s5(s5),
        .s6(s6),
        .s7(s7),
        .s8(s8),
        .s9(s9),
        .s10(s10),
        .s11(s11),
        .t3(t3),
        .t4(t4),
        .t5(t5),
        .t6(t6),
        .clk_25m(clkdiv[1]),
        .clk_100m(clk_100mhz),
        .rst(rst),
        .pc(PC[31:0]),
        .inst(inst_in[31:0]),
        .mem_wen(MemRW),
        .mem_ren(~MemRW),
        .dmem_o_data(RAM_B_douta[31:0]),
        .dmem_i_data(ram_data_in[31:0]),
        .dmem_addr(ram_addr[9:0]),
        .hs(HSYNC),
        .vs(VSYNC),
        .vga_r(Red[3:0]),
        .vga_g(Green[3:0]),
        .vga_b(Blue[3:0]),
        .a_val(a_val),
        .b_val(b_val),
        .alu_ctrl(alu_ctrl),
        .alu_res(alu_res),
        .cmp_res(cmp_res),
        .rs1(inst_in[19:15]),
        .rs1_val(rs1_val),
        .rs2(inst_in[24:20]),
        .rs2_val(rs2_val),
        .rd(inst_in[11:7]),
        .reg_i_data(reg_i_data),
        .reg_wen(reg_wen),
        .is_branch(is_branch),
        .is_jal(is_jal),
        .is_jalr(is_jalr),
        .do_branch(do_branch),
        .pc_branch(pc_branch),
        .imm(imm),
        .is_imm (is_imm),
        .is_lui(is_lui),
        .mcause_o(inst_in[6:0]),
        .mstatus_o(test)
    );
endmodule
```

